(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goodlist/goodlist"],{"0f21":function(t,e,o){"use strict";o.r(e);var n=o("3836"),s=o.n(n);for(var i in n)"default"!==i&&function(t){o.d(e,t,function(){return n[t]})}(i);e["default"]=s.a},"29f7":function(t,e,o){},3836:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(o("a34a"));function s(t){return t&&t.__esModule?t:{default:t}}function i(t,e,o,n,s,i,r){try{var a=t[i](r),c=a.value}catch(u){return void o(u)}a.done?e(c):Promise.resolve(c).then(n,s)}function r(t){return function(){var e=this,o=arguments;return new Promise(function(n,s){var r=t.apply(e,o);function a(t){i(r,n,s,a,c,"next",t)}function c(t){i(r,n,s,a,c,"throw",t)}a(void 0)})}}var a=function(){return o.e("components/uni-popup/uni-popup").then(o.bind(null,"bf97"))},c={data:function(){return{maskclose:!1,couponmask:!1,showcan:!1,title:"product-list",productList:[],myproductList:[],userproductList:[],renderImage:!1,allmoney:0,getticket:"",getcoupontype:"",couponid:0,timerId:null,reqTime:2400,types:{type:String,default:""},color:{type:String,default:"#878ea3"},list:[{id:1,title:"日常用品立减10元",termStart:"2019-04-01",termEnd:"2019-05-30",ticket:"10",criteria:"满50使用",state:0,type:0}],ispay:0,waitpayTime:30,timerIdforgood:null}},components:{uniPopup:a},methods:{postpay:function(){var e=r(n.default.mark(function e(o,s,i,r,a,c,u,l,d){var p,h,f=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$apis.accountorder({openid:o,ordernum:s,allmoney:i,getcoupontype:r,getticket:a,body:c,goodimg:u,couponid:l,goodinfo:JSON.stringify(d)});case 2:p=e.sent,t.showLoading({title:"支付中..."}),h=this,1==p.code?(console.log(h.ispay,"是否支付"),this.timerIdforgood=setInterval(function(){h.checkgoodorder(o,s),setTimeout(function(){1==h.ispay&&(clearInterval(h.timerIdforgood),console.log(h.ispay,"走支付成功"),t.hideLoading(),t.showModal({title:"购买完成提示",content:"欢迎再次光临！",showCancel:f.showcan,success:function(e){e.confirm?t.reLaunch({url:"../../pages/index/index"}):e.cancel&&console.log("用户点击取消")}}))},200);var e=f.waitpayTime;e--,f.waitpayTime=e,e<1&&(clearInterval(f.timerIdforgood),h.backyue(o,s),h.waitpayTime=30,t.hideLoading(),t.showModal({title:"购买异常提示",content:"请检查微信余额支付是否足以支付此次购买金额，或者网络是否正常，欢迎再次购买！",showCancel:f.showcan,success:function(e){e.confirm&&t.reLaunch({url:"../../pages/index/index"})}})),console.log("请求支付结果"+e)},400)):(console.log("走支付流程失败"),t.hideLoading(),t.showModal({title:"购买异常提示",content:"异常信息："+p.msg,showCancel:this.showcan,success:function(e){e.confirm&&t.reLaunch({url:"../../pages/index/index"})}}));case 6:case"end":return e.stop()}},e,this)}));function o(t,o,n,s,i,r,a,c,u){return e.apply(this,arguments)}return o}(),checkgoodorder:function(){var t=r(n.default.mark(function t(e,o){var s,i;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$apis.checkgoodorder({openid:e,out_trade_no:o});case 2:s=t.sent,i=this,console.log(s.data,"检查支付返回"),1==s.data?i.ispay=1:i.ispay=0,console.log(i.ispay,"t.ispay");case 7:case"end":return t.stop()}},t,this)}));function e(e,o){return t.apply(this,arguments)}return e}(),backyue:function(){var t=r(n.default.mark(function t(e,o){return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$apis.backyue({openid:e,out_trade_no:o});case 2:t.sent;case 3:case"end":return t.stop()}},t,this)}));function e(e,o){return t.apply(this,arguments)}return e}(),updatecloseorder:function(){var t=r(n.default.mark(function t(e,o,s,i,r){return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$apis.updatecloseorder({allmoney:e,ordernum:o,goodinfo:JSON.stringify(s),goodtitle:i,goodimg:r});case 2:t.sent;case 3:case"end":return t.stop()}},t,this)}));function e(e,o,n,s,i){return t.apply(this,arguments)}return e}(),mycouponlist:function(){var e=r(n.default.mark(function e(){var o,s,i,r,a,c,u,l,d;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=t.getStorageSync("openid"),e.next=3,this.$apis.mycouponlist({openId:o});case 3:if(s=e.sent,this.list=s.data.couponList,s.data.couponList.length>0)if(this.allmoney>0){for(i="",r="",a=0;a<this.userproductList.length;a++)i+=this.userproductList[a].name+",";r=this.userproductList[0].image,c=t.getStorageSync("ordernum"),this.updatecloseorder(this.allmoney,c,this.userproductList,i,r),this.$refs.popups.open()}else t.showModal({title:"完成提示",content:"欢迎再次光临！",showCancel:this.showcan,success:function(e){e.confirm?t.reLaunch({url:"../../pages/index/index"}):e.cancel&&console.log("用户点击取消")}});else if(this.allmoney>0){for(u="",l="",a=0;a<this.userproductList.length;a++)u+=this.userproductList[a].name+",";l=this.userproductList[0].image,console.log(this.userproductList,"提交的商品"),console.log(u,"提交的商品名称"),console.log(this.allmoney,"商品总额"),console.log(l,"提交的商品图片"),d=t.getStorageSync("ordernum"),this.postpay(o,d,this.allmoney,0,0,u,l,0,this.userproductList)}else t.showModal({title:"完成提示",content:"欢迎再次光临！",showCancel:this.showcan,success:function(e){e.confirm?t.reLaunch({url:"../../pages/index/index"}):e.cancel&&console.log("用户点击取消")}});case 6:case"end":return e.stop()}},e,this)}));function o(){return e.apply(this,arguments)}return o}(),docheck:function(t){console.log(t,"22"),this.list[t].state=!this.list[t].state;for(var e=0;e<this.list.length;e++)e!=t&&(this.list[e].state=0)},postcoupon:function(){for(var e=this,o=[],n=0;n<this.list.length;n++)this.list[n].state&&o.push(this.list[n]);if(0==o.length)t.showModal({title:"温馨提示",content:"确定不使用任何优惠卡券吗？",confirmText:"不稀罕",success:function(o){if(o.confirm){console.log("用户点击确定");for(var n="",s="",i=0;i<e.userproductList.length;i++)n+=e.userproductList[i].name;s=e.userproductList[0].image,console.log(n,"提交的商品名称"),console.log(s,"提交的商品图片"),console.log(e.allmoney,"商品总额"),console.log(e.userproductList,"提交的商品");var r=t.getStorageSync("ordernum"),a=t.getStorageSync("openid");e.postpay(a,r,e.allmoney,0,0,n,s,0,e.userproductList)}else o.cancel&&console.log("用户点击取消")}});else{e.getticket=o[0].ticket,e.getcoupontype=o[0].type,e.couponid=o[0].id;var s="",i="";for(n=0;n<e.userproductList.length;n++)s+=e.userproductList[n].name;i=e.userproductList[0].image,console.log(s,"提交的商品名称"),console.log(i,"提交的商品图片"),console.log(this.allmoney,"商品总额"),console.log(this.userproductList,"提交的商品"),console.log(o[0].ticket,"优惠金额"),console.log(o[0].type,"优惠类型"),console.log(o[0].id,"优惠id"),console.log(o,"选中的优惠券");var r=t.getStorageSync("ordernum"),a=t.getStorageSync("openid");this.postpay(a,r,e.allmoney,o[0].type,o[0].ticket,s,i,o[0].id,e.userproductList)}},showmode:function(){this.$refs.popup.open()},hiddenmode:function(){this.$refs.popup.close()},getallgood:function(){var t=r(n.default.mark(function t(e){var o;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$apis.getallgood({sn:e});case 2:o=t.sent,console.log(o.data,"返回商品"),this.myproductList=o.data;case 5:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),getgood:function(){var t=r(n.default.mark(function t(e){var o;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$apis.getgood({orderId:e});case 2:o=t.sent,console.log(o.data,"返回用户商品"),o.data.data.products.length>0&&this.showmode(),o.data.data.close&&(clearInterval(this.timerId),this.hiddenmode(),this.mycouponlist()),this.userproductList=o.data.data.products,this.totalmoney(o.data.data.products);case 8:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),toIndex:function(){clearInterval(this.timerId),t.reLaunch({url:"../../pages/index/index"})},totalmoney:function(t){var e=t,o=0;if(e.length){for(var n=0;n<e.length;n++)o+=e[n].number*e[n].price;o=o.toFixed(2),console.log("计算价格:",o),this.allmoney=o}else this.allmoney=0}},onLoad:function(e){var o=this;console.log(e.productNumber,"传过来"),this.getallgood(e.productNumber),setTimeout(function(){o.renderImage=!0},300);var n=t.getStorageSync("ordernum");this.timerId=setInterval(function(){var e=o.reqTime;e--,o.reqTime=e,e<1&&(clearInterval(o.timerId),t.reLaunch({url:"../../pages/index/index"})),console.log(e,"请求时间"),o.getgood(n)},500)}};e.default=c}).call(this,o("543d")["default"])},"4deb":function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},s=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return s})},"4fad":function(t,e,o){"use strict";var n=o("29f7"),s=o.n(n);s.a},"79c7":function(t,e,o){"use strict";o.r(e);var n=o("4deb"),s=o("0f21");for(var i in s)"default"!==i&&function(t){o.d(e,t,function(){return s[t]})}(i);o("4fad");var r=o("2877"),a=Object(r["a"])(s["default"],n["a"],n["b"],!1,null,null,null);e["default"]=a.exports}},[["e325","common/runtime","common/vendor"]]]);